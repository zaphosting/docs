"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5102],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=u(n),d=r,g=p["".concat(l,".").concat(d)]||p[d]||h[d]||a;return n?o.createElement(g,i(i({ref:t},c),{},{components:n})):o.createElement(g,i({ref:t},c))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},600:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var o=n(7462),r=(n(7294),n(3905));const a={id:"vserver_linux_ssh2fa",title:"VPS Setting up two-factor authentication for Linux servers",description:"Information on how to set up two-factor authentication for your Linux VPS from ZAP-Hosting - ZAP-Hosting.com documentation",sidebar_label:"Two factor authentication"},i=void 0,s={unversionedId:"vserver_linux_ssh2fa",id:"vserver_linux_ssh2fa",title:"VPS Setting up two-factor authentication for Linux servers",description:"Information on how to set up two-factor authentication for your Linux VPS from ZAP-Hosting - ZAP-Hosting.com documentation",source:"@site/docs/vserver_linux_ssh2fa.md",sourceDirName:".",slug:"/vserver_linux_ssh2fa",permalink:"/guides/docs/vserver_linux_ssh2fa",draft:!1,editUrl:"https://github.com/zaphosting/docs/tree/master/docs/vserver_linux_ssh2fa.md",tags:[],version:"current",frontMatter:{id:"vserver_linux_ssh2fa",title:"VPS Setting up two-factor authentication for Linux servers",description:"Information on how to set up two-factor authentication for your Linux VPS from ZAP-Hosting - ZAP-Hosting.com documentation",sidebar_label:"Two factor authentication"},sidebar:"vpsrootSidebar",previous:{title:"SSH Key",permalink:"/guides/docs/vserver_linux_sshkey"},next:{title:"Change Password",permalink:"/guides/docs/vserver_linux_password_change"}},l={},u=[{value:"Install Google Authenticator",id:"install-google-authenticator",level:2},{value:"Run Google Authenticator",id:"run-google-authenticator",level:2},{value:"Configure Google Authenticator",id:"configure-google-authenticator",level:2},{value:"/etc/ssh/sshd_config",id:"etcsshsshd_config",level:3},{value:"/etc/pam.d/sshd",id:"etcpamdsshd",level:3},{value:"Log in with 2FA",id:"log-in-with-2fa",level:2}],c={toc:u},p="wrapper";function h(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"install-google-authenticator"},"Install Google Authenticator"),(0,r.kt)("p",null,"First you need to install the Google Authenticator on your Linux vServer/Rootserver. Execute the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt install libpam-google-authenticator\n")),(0,r.kt)("p",null,'You will then be prompted to type "Y" to install the package, type this, press Enter and then the Google Authenticator will be installed!'),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166183966-276ee6c7-4b17-4fb3-9283-94f2a663b0a1.png",alt:null})),(0,r.kt)("h2",{id:"run-google-authenticator"},"Run Google Authenticator"),(0,r.kt)("p",null,"Start the Google Authenticator by typing 'google-authenticator'. Make sure that your window size is sufficient for the QR Code, otherwise press \"CTRL+C\" and enter it again."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166183981-22467640-91a8-41e2-ad2d-a48532e1b9fc.png",alt:null})),(0,r.kt)("p",null,'You will now be prompted again if you want to execute it, type "Y" to accept. '),(0,r.kt)("p",null,"You will now get a QR Code. Open your Authenticator app on your smartphone and scan the QR Code.For this example we use the Google Authenticator:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/13604413/159171815-4a7368da-fab1-4284-9c90-e310a577dbbf.png",alt:"image"})),(0,r.kt)("p",null,"Make sure to copy the backup codes, these can each be used once in case you lose your authenticator."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166183994-39e1b89a-0227-4c92-b455-23995d06acb5.png",alt:null})),(0,r.kt)("p",null,"Now the app already shows you the codes you need to log in later. In this case it looks like this:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166184007-8faed2ff-1559-4f19-8143-f4acaee70918.png",alt:null})),(0,r.kt)("p",null,"The following questions are now prompted:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Do you want to save the Google Authenticator configuration?"),(0,r.kt)("li",{parentName:"ol"},"Do you want only one login every 30 seconds? "),(0,r.kt)("li",{parentName:"ol"},"Should the time in which a code is usable be increased?"),(0,r.kt)("li",{parentName:"ol"},"Should only three logins be possible every 30 seconds? (Protection against Brute Force)")),(0,r.kt)("p",null,"For security reasons we recommend to confirm all with Yes. "),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166184028-9636c936-18da-414d-bc1e-4ea233bb6185.png",alt:null})),(0,r.kt)("h2",{id:"configure-google-authenticator"},"Configure Google Authenticator"),(0,r.kt)("p",null,"Now we have to adjust the Google Authenticator so that it is also used. This requires two adjustments. "),(0,r.kt)("h3",{id:"etcsshsshd_config"},"/etc/ssh/sshd_config"),(0,r.kt)("p",null,"Activate the required modules in the ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/ssh/sshd_config'. Open the "),"/etc/ssh/sshd_config' file by typing "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo nano /etc/ssh/sshd_config\n")),(0,r.kt)("p",null,"You are now in a text editor. You can move around with the arrow keys, freely delete text and enter and then press 'CTRL + X' then 'Y' and lastly 'Enter' to save the file."),(0,r.kt)("p",null,"Make sure that the two lines 'UsePAM' and 'ChallengeResponseAuthentication' are set to 'yes'. Like this:"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166184047-0f7784fc-67bd-4380-9f68-5630736a9422.png",alt:null})),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166184062-5de87b6c-2e49-4352-9665-9823178257c9.png",alt:null})),(0,r.kt)("p",null,"Save the file with 'CTRL + X' then 'Y' and lastly 'Enter`. Restart SSH afterwards with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo systemctl restart ssh\n")),(0,r.kt)("h3",{id:"etcpamdsshd"},"/etc/pam.d/sshd"),(0,r.kt)("p",null,"Now we add the Google Authenticator to the login in the ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/pam.d/sshd"),".Open the ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/pam.d/sshd")," file by typing ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo nano /etc/pam.d/sshd"),". "),(0,r.kt)("p",null,"The last step is to scroll down to the end of the file and enter 'auth required pam_google_authenticator.so'."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166184084-1e07230b-6691-4bb8-8977-bcc784342afa.png",alt:null})),(0,r.kt)("p",null,"Save the file with 'CTRL + X' then 'Y' and lastly 'Enter`"),(0,r.kt)("h2",{id:"log-in-with-2fa"},"Log in with 2FA"),(0,r.kt)("p",null,"Now it is time to log in for the first time with 2FA. After you have followed the steps above, all you need to do is restart your SSH connection."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/13604413/159171829-90fb3349-c238-4558-818a-0657b87062e5.png",alt:"image"})),(0,r.kt)("p",null,"You now enter your password as normal. You will be asked for a code, simply enter the recent 2FA code."),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/61839701/166184108-ed9c504c-e6cc-4b28-8afa-210f245f76d3.png",alt:null})),(0,r.kt)("p",null,"Now you are logged in!"))}h.isMDXComponent=!0}}]);