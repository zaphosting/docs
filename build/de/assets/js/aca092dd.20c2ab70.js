"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9535],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>g});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),d=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},u=function(e){var n=d(e.components);return r.createElement(l.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=d(t),p=a,g=c["".concat(l,".").concat(p)]||c[p]||m[p]||i;return t?r.createElement(g,s(s({ref:n},u),{},{components:t})):r.createElement(g,s({ref:n},u))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,s=new Array(i);s[0]=p;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[c]="string"==typeof e?e:a,s[1]=o;for(var d=2;d<i;d++)s[d]=t[d];return r.createElement.apply(null,s)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},8949:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var r=t(7462),a=(t(7294),t(3905));const i={id:"vserver_linux_mastodon",title:"Mastodon auf Server installieren",description:"Informationen, wie du einen Mastodon Server auf deinem vServer von ZAP-Hosting einrichten kannst - ZAP-Hosting.com Dokumentationen",sidebar_label:"Mastodon installieren"},s=void 0,o={unversionedId:"vserver_linux_mastodon",id:"vserver_linux_mastodon",title:"Mastodon auf Server installieren",description:"Informationen, wie du einen Mastodon Server auf deinem vServer von ZAP-Hosting einrichten kannst - ZAP-Hosting.com Dokumentationen",source:"@site/i18n/de/docusaurus-plugin-content-docs/current/vserver_linux_mastodon.md",sourceDirName:".",slug:"/vserver_linux_mastodon",permalink:"/guides/de/docs/vserver_linux_mastodon",draft:!1,editUrl:"https://github.com/zaphosting/docs/tree/master/docs/vserver_linux_mastodon.md",tags:[],version:"current",frontMatter:{id:"vserver_linux_mastodon",title:"Mastodon auf Server installieren",description:"Informationen, wie du einen Mastodon Server auf deinem vServer von ZAP-Hosting einrichten kannst - ZAP-Hosting.com Dokumentationen",sidebar_label:"Mastodon installieren"}},l={},d=[{value:"Was ist Mastodon?",id:"was-ist-mastodon",level:2},{value:"Voraussetzungen",id:"voraussetzungen",level:2},{value:"Systemvorbereitung",id:"systemvorbereitung",level:2},{value:"Ruby installieren",id:"ruby-installieren",level:2},{value:"PostgreSQL konfigurieren",id:"postgresql-konfigurieren",level:2},{value:"Mastodon einrichten",id:"mastodon-einrichten",level:2},{value:"Konfiguration des Webservers",id:"konfiguration-des-webservers",level:2},{value:"Erstellen eines Mastodon-Dienstes",id:"erstellen-eines-mastodon-dienstes",level:2}],u={toc:d},c="wrapper";function m(e){let{components:n,...t}=e;return(0,a.kt)(c,(0,r.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"was-ist-mastodon"},"Was ist Mastodon?"),(0,a.kt)("p",null,"Mastodon ist ein verteilter Mikroblogging-Dienst, der seit 2016 von Eugen Rochko und der von ihm in Jena gegr\xfcndeten und in Berlin ans\xe4ssigen Mastodon gGmbH entwickelt wird."),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/32127408/207198152-fa6ca1e6-b845-4fd8-83d9-cc4a8fb91f9f.png",alt:"image"})),(0,a.kt)("p",null,"Im Gegensatz zu gro\xdfen vergleichbaren Diensten wie Twitter ist Mastodon als dezentrales Netzwerk konzipiert, das nicht auf einer Plattform basiert:\nVerschiedene Server, von Privatpersonen, Vereinen oder sonstigen Stellen eigenverantwortlich betrieben, k\xf6nnen miteinander interagieren."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Diese Anleitung basiert auf einem auf Debian basierten Betriebssystem. Diese Anleitung varriert je nach Betriebssystem.")),(0,a.kt)("h2",{id:"voraussetzungen"},"Voraussetzungen"),(0,a.kt)("p",null,"F\xfcr das aufsetzen einer Mastodon Instanz, ben\xf6tigst du folgendes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Domain"),(0,a.kt)("li",{parentName:"ul"},"Linux basierten Server"),(0,a.kt)("li",{parentName:"ul"},"E-Mail Server")),(0,a.kt)("h2",{id:"systemvorbereitung"},"Systemvorbereitung"),(0,a.kt)("p",null,"Wir empfehlen, das Deaktivieren vom Passwortlogin \xfcber SSH, da dies ein Sicherheitsrisiko darstellt, vor allem auf Servern, die aus dem Internet erreichbar sind. Dies kannst du im Webinterface unter Informationen -> Zugang & Sicherheit -> Deaktiviere Passwortlogin machen.\n",(0,a.kt)("img",{parentName:"p",src:"https://user-images.githubusercontent.com/32127408/207198356-d36eeb4d-647c-4102-9d09-dcaebd8a29b5.png",alt:"image"}),"\nDanach verbinden wir uns mit SSH und f\xfchren folgenden Befehl aus:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"apt update && apt upgrade -y\n")),(0,a.kt)("p",null,"Als n\xe4chstes installieren wir die ben\xf6tigten Repositories:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'# System Repositories\napt install -y curl wget gnupg apt-transport-https lsb-release ca-certificates\n# Node.JS\ncurl -sL https://deb.nodesource.com/setup_16.x | bash -\n# PostgreSQL\nwget -O /usr/share/keyrings/postgresql.asc https://www.postgresql.org/media/keys/ACCC4CF8.asc\necho "deb [signed-by=/usr/share/keyrings/postgresql.asc] http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" > /etc/apt/sources.list.d/postgresql.list\n')),(0,a.kt)("p",null,"Daraufhin installieren wir die ersten Abh\xe4ngigkeiten von Mastodon:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"apt update\napt install -y \\\n  imagemagick ffmpeg libpq-dev libxml2-dev libxslt1-dev file git-core \\\n  g++ libprotobuf-dev protobuf-compiler pkg-config nodejs gcc autoconf \\\n  bison build-essential libssl-dev libyaml-dev libreadline6-dev \\\n  zlib1g-dev libncurses5-dev libffi-dev libgdbm-dev \\\n  nginx redis-server redis-tools postgresql postgresql-contrib \\\n  certbot python3-certbot-nginx libidn11-dev libicu-dev libjemalloc-dev\n")),(0,a.kt)("p",null,"Das Installieren der Pakete kann einige Zeit in Anspruch nehmen. Nachdem diese installiert sind, m\xfcssen wir yarn konfigurieren. Dies ist der Paketmanager vom vorher installiertem node.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"corepack enable\nyarn set version stable\n")),(0,a.kt)("h2",{id:"ruby-installieren"},"Ruby installieren"),(0,a.kt)("p",null,"Um Ruby zu installieren, erstellen wir einen separaten Benutzer. Dies macht das Verwalten von verschiedenen Ruby Versionen einfacher. Daf\xfcr erstellen wir den Benutzer Mastodon, dessen Login deaktiviert ist und loggen uns in das Konto ein:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# You can just leave the fields empty\nadduser --disabled-login mastodon\nsu - mastodon\n")),(0,a.kt)("p",null,"Nun installieren wir den Ruby-Manager ",(0,a.kt)("inlineCode",{parentName:"p"},"rbenv"),", dieser macht das Verwalten von Ruby einfacher. Diesen kannst du mit der folgenden Befehlsfolge umsetzen:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/rbenv/rbenv.git ~/.rbenv\ncd ~/.rbenv && src/configure && make -C src\necho 'export PATH=\"$HOME/.rbenv/bin:$PATH\"' >> ~/.bashrc\necho 'eval \"$(rbenv init -)\"' >> ~/.bashrc\nexec bash\ngit clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build\n")),(0,a.kt)("p",null,"Nach der Installation k\xf6nnen wir nun Ruby installieren. In diesem Schritt werden wir ebenfalls Bundler installieren."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"RUBY_CONFIGURE_OPTS=--with-jemalloc rbenv install 3.0.3\nrbenv global 3.0.3\ngem install bundler --no-document\n")),(0,a.kt)("p",null,"Dies kann einige Zeit in Anspruch nehmen. Sobald die Installation erfolgreich abgeschlossen wurde, verlassen wir das Mastodon Konto mit dem Befehl ",(0,a.kt)("inlineCode",{parentName:"p"},"exit")),(0,a.kt)("h2",{id:"postgresql-konfigurieren"},"PostgreSQL konfigurieren"),(0,a.kt)("p",null,"Mastodon nutzt als Datenbanksystem PostgreSQL. Die Konfiguration ist schnell durch folgende Befehle erledigt. Dazu melden wir uns zuerst in Postgres an"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo -u postgres psql\n")),(0,a.kt)("p",null,"Dann f\xfchren wir folgende Befehle der Reihe nach aus:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE USER mastodon CREATEDB;\n\\q\n")),(0,a.kt)("h2",{id:"mastodon-einrichten"},"Mastodon einrichten"),(0,a.kt)("p",null,"Nun m\xfcssen wir erneut in das Mastodon Nutzerprofil wechseln:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"su - mastodon\n")),(0,a.kt)("p",null,"Jetzt klonen wir Git mittels dem folgenden Befehl:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/tootsuite/mastodon.git live && cd live\ngit checkout $(git tag -l | grep -v 'rc[0-9]*$' | sort -V | tail -n 1)\n")),(0,a.kt)("p",null,"Als n\xe4chstes m\xfcssen wir noch einige Abh\xe4ngigkeiten installieren:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"bundle config deployment 'true'\nbundle config without 'development test'\nbundle install -j$(getconf _NPROCESSORS_ONLN)\nyarn install --pure-lockfile\n")),(0,a.kt)("p",null,"Nun erstellen wir die Mastodon Konfiguration mit dem folgenden Befehl"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"RAILS_ENV=production bundle exec rake mastodon:setup\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Sollte die Datenbank installation Fehlschlagen, melde dich mittels ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo -u postgres psql")," in der SQL Datenbank an und folge dieser Dokumentation (Englisch)\n",(0,a.kt)("a",{parentName:"p",href:"https://gist.github.com/amolkhanorkar/8706915"},"https://gist.github.com/amolkhanorkar/8706915"))),(0,a.kt)("p",null,"Danach wechsle zur\xfcck auf den Root-Benutzer mit dem Befehl ",(0,a.kt)("inlineCode",{parentName:"p"},"exit")),(0,a.kt)("h2",{id:"konfiguration-des-webservers"},"Konfiguration des Webservers"),(0,a.kt)("p",null,"Als n\xe4chstes kommt der komplizierte Teil. Erstelle einen A- (IPv4) oder AAAA- (IPv6) Record in deiner DNS Konfiguration um deine (Sub-)Domain auf deiner Mastodon Instanz zu leiten. Alternativ kannst du auch den Root-Record (@) auf deinen Server zeigen lassen."),(0,a.kt)("p",null,"Jetzt musst du die Webserver Konfiguration anpassen, sodass dein Webserver auch die Mastodon Webseite erkennt und freigeben kann. Dies machst du wie folgt."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"cp /home/mastodon/live/dist/nginx.conf /etc/nginx/sites-available/mastodon\nln -s /etc/nginx/sites-available/mastodon /etc/nginx/sites-enabled/mastodon\n")),(0,a.kt)("p",null,"Danach bearbeite die Konfiguration ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-available/mastodon")," mit einem Editor wie vim oder nano und \xe4ndere example.com zu deiner Domain.\nAls N\xe4chstes ben\xf6tigst du noch ein SSL Zertifikat f\xfcr deine Mastodon Instanz, um die Daten\xfcbertragung zu verschl\xfcsseln. Dies machst du folgenderma\xdfen:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"certbot --nginx -d <your domain>\n")),(0,a.kt)("p",null,"Gib deine Domain an. Danach wirst du nach einigen Daten zu deinem SSL Zertifikat angeben m\xfcssen. "),(0,a.kt)("h2",{id:"erstellen-eines-mastodon-dienstes"},"Erstellen eines Mastodon-Dienstes"),(0,a.kt)("p",null,"Zum Schluss erstellen wir einen Mastodon System Service. Dies erleichtert den Autostart sowie die Verwaltung von Mastodon. Dies machst du wie folgt: "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"cp /home/mastodon/live/dist/mastodon-*.service /etc/systemd/system/\n")),(0,a.kt)("p",null,"Lade deine Systemdienste neu und starte anschlie\xdfend den Mastodon Service. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"systemctl daemon-reload\nsystemctl enable --now mastodon-web mastodon-sidekiq mastodon-streaming\n")),(0,a.kt)("p",null,"Nach einem Neustart ist deine Installation fertig und ready-to-go f\xfcr den Livebtrieb!"))}m.isMDXComponent=!0}}]);