---
id: vserver-linux-certbot
title: "VPS: ตั้งค่า Certbot บน Linux"
description: "ค้นพบวิธีการปกป้องเว็บไซต์ของคุณด้วยใบรับรอง SSL ฟรีโดยใช้ Certbot และ Let's Encrypt เพื่อการส่งข้อมูลที่ปลอดภัย → เรียนรู้เพิ่มเติมตอนนี้"
sidebar_label: ติดตั้ง Certbot
services:
  - vserver
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import InlineVoucher from '@site/src/components/InlineVoucher';

## บทนำ

ใบรับรอง SSL เป็นส่วนสำคัญของอินเทอร์เน็ต ช่วยให้ข้อมูลถูกส่งอย่างปลอดภัยระหว่างลูกค้าและโฮสต์ ในคู่มือนี้ เราจะสำรวจขั้นตอนการตั้งค่าเครื่องมือโอเพนซอร์ส [**Certbot**](https://certbot.eff.org/) เพื่อขอใบรับรอง SSL ฟรีจากหน่วยงานออกใบรับรองไม่แสวงหากำไร **Let's Encrypt**

<InlineVoucher />

## การเตรียมตัว

เพื่อใช้ Certbot คุณจะต้องมีเซิร์ฟเวอร์ Linux และ **โดเมน** ที่คุณเป็นเจ้าของ คุณต้องสามารถเข้าถึงการตั้งค่า DNS ของโดเมน และคุณ **ต้อง** สร้างระเบียน DNS ประเภท `A` ชี้ไปยังที่อยู่ IP ของ __เซิร์ฟเวอร์ Linux__ ของคุณสำหรับโดเมนหลักหรือซับโดเมนที่คุณวางแผนจะใช้

Certbot ยังมีปลั๊กอินเสริมที่ช่วยให้คุณตั้งค่าใบรับรองสำหรับโดเมนได้ง่าย ๆ แบบ "คลิกเดียว" ซึ่งรองรับเว็บเซิร์ฟเวอร์หลายตัว เช่น Nginx หรือ Apache เราแนะนำให้ใช้ Nginx เพราะเป็นเว็บเซิร์ฟเวอร์โอเพนซอร์สที่มีประสิทธิภาพสูงและได้รับความนิยม ดู [คู่มือ Linux reverse proxy](vserver-linux-proxy.md) ของเราเพื่อช่วยตั้งค่านี้

## การติดตั้ง

เริ่มต้นด้วยการติดตั้งแพ็กเกจโอเพนซอร์ส [**Certbot**](https://certbot.eff.org/) ซึ่งคุณจะใช้ขอใบรับรอง SSL ฟรีจาก **Let's Encrypt**

```
sudo apt install certbot
```

เมื่อ Certbot ถูกติดตั้งแล้ว คุณสามารถขอใบรับรองสำหรับโดเมนของคุณได้ Let's Encrypt และ Certbot มีวิธี ACME Challenges หลายแบบเพื่อยืนยันความเป็นเจ้าของโดเมน

เราแนะนำให้ใช้วิธี **HTTP-01** เป็นค่าเริ่มต้นเพราะรองรับการต่ออายุอัตโนมัติ แต่ถ้าคุณเจอปัญหา คุณสามารถลองใช้วิธี **DNS-01** เป็นทางเลือก ซึ่งเป็นแบบแมนนวลและไม่รองรับการต่ออายุอัตโนมัติเพราะต้องยืนยันผ่านระเบียน DNS ประเภท **TXT**

:::tip ใช้ปลั๊กอินเว็บเซิร์ฟเวอร์
สำหรับคนที่ใช้เว็บเซิร์ฟเวอร์อย่าง Nginx, Apache หรือเว็บเซิร์ฟเวอร์ของตัวเอง เราแนะนำให้ไปที่ส่วน **ปลั๊กอินเว็บเซิร์ฟเวอร์** ด้านล่าง ซึ่งแสดงวิธีใช้ปลั๊กอิน Certbot เสริมสำหรับเว็บเซิร์ฟเวอร์เหล่านี้ เพื่อการติดตั้งแบบ "คลิกเดียว" และขอใบรับรองโดยไม่ต้องปิดเว็บเซิร์ฟเวอร์
:::

### การท้าทาย HTTP-01

เมื่อ Certbot ถูกติดตั้งแล้ว คุณสามารถขอใบรับรองสำหรับโดเมนของคุณได้ ในตัวอย่างนี้ เราจะใช้โหมด standalone ซึ่งหมายความว่า Certbot จะเริ่มเว็บเซิร์ฟเวอร์ชั่วคราวเพื่อทำการท้าทาย คุณต้องเปิดพอร์ต 80 ในไฟร์วอลล์และไม่มีเว็บเซิร์ฟเวอร์หรือบริการใด ๆ รันอยู่บนพอร์ต 80 เพื่อให้เว็บเซิร์ฟเวอร์ชั่วคราวนี้ทำงานและดึงข้อมูลท้าทายได้ (จึงเป็นที่มาของชื่อ `HTTP` ในการท้าทายนี้)

ในคำสั่งต่อไปนี้ คุณจะใช้พารามิเตอร์ `--standalone` เพื่อบอก Certbot ว่าคุณต้องการใช้ตัวเลือกเว็บเซิร์ฟเวอร์ชั่วคราว

```
# สำหรับโดเมนหลัก
certbot certonly --standalone -d [your_root_domain] -d www.[your_root_domain]

# สำหรับซับโดเมน
certbot certonly --standalone -d [your_domain]

# ตั้งค่าแบบโต้ตอบ
certbot certonly --standalone
```

เมื่อรันคำสั่งนี้ คุณอาจต้องทำตามขั้นตอนตั้งค่าแบบโต้ตอบครั้งแรก ซึ่งจะขอให้คุณใส่อีเมลสำหรับการสื่อสารเกี่ยวกับใบรับรอง ตามด้วยตัวเลือกสมัครรับจดหมายข่าว และเงื่อนไขที่คุณต้องยอมรับ

Certbot จะสร้าง ACME Challenge และโฮสต์ผ่านเว็บเซิร์ฟเวอร์ชั่วคราว เซิร์ฟเวอร์ของ Let's Encrypt จะพยายามดึงข้อมูลนี้จากเซิร์ฟเวอร์ของคุณ และเมื่อสำเร็จ ใบรับรองจะถูกสร้างและบันทึกไว้ที่เส้นทาง `/etc/letsencrypt/live/[your_domain]`

![](https://screensaver01.zap-hosting.com/index.php/s/7oGcQotKaowaDzM/preview)

คุณสามารถใช้ใบรับรอง SSL ได้ทุกที่ที่ต้องการโดยระบุเส้นทางภายในเครื่องไปยังใบรับรองเหล่านี้

### ระเบียน DNS ประเภท TXT

ถ้าคุณเจอปัญหาในการยืนยันโดเมนผ่านวิธี **HTTP-01** คุณสามารถลองใช้วิธี **DNS-01** ซึ่งต้องสร้างระเบียน DNS ประเภท **TXT** โดยมีค่าที่ Let's Encrypt กำหนดให้

อย่างที่บอกไป วิธีนี้ **ไม่** รองรับการต่ออายุอัตโนมัติ เว้นแต่คุณจะตั้งโครงสร้างพื้นฐานของตัวเองเพื่อจัดการเรื่องนี้ ดังนั้นจึงแนะนำให้ใช้วิธี **HTTP-01** เท่าที่จะทำได้

ในคำสั่งต่อไปนี้ คุณจะใช้พารามิเตอร์ `--preferred-challenges` เพื่อบอก Certbot ว่าคุณต้องการใช้วิธี `DNS-01`

```
# สำหรับโดเมนหลัก
certbot certonly --preferred-challenges dns-01 -d [your_root_domain] -d www.[your_root_domain] --manual -m [your_root_domain] -m www.[your_root_domain]

# สำหรับซับโดเมน
certbot certonly --preferred-challenges dns-01 -d [your_domain] --manual -m [your_domain]

# ตั้งค่าแบบโต้ตอบ
certbot certonly --preferred-challenges dns-01
```

เมื่อรันคำสั่งนี้ คุณอาจต้องทำตามขั้นตอนตั้งค่าแบบโต้ตอบครั้งแรก ซึ่งจะขอให้อีเมลสำหรับการสื่อสารเกี่ยวกับใบรับรอง ตามด้วยตัวเลือกสมัครรับจดหมายข่าว และเงื่อนไขที่ต้องยอมรับ

Certbot จะให้คำแนะนำในการสร้างระเบียน DNS ประเภท **TXT** ที่มีค่าเฉพาะเจาะจงให้คุณใช้ โดยเป้าหมายจะเป็น `_acme-challenge.` ตามด้วยโดเมนของคุณ (ในตัวอย่างนี้คือ `_acme-challenge.zapdocs.example.com`) และค่าที่ต้องตั้งจะปรากฏในคอนโซล

เมื่อคุณสร้างระเบียนแล้ว กด enter เพื่อดำเนินการต่อ ถ้าทุกอย่างถูกต้องและข้อมูลถูกเผยแพร่แล้ว ใบรับรองจะถูกสร้างและบันทึกไว้ที่ `/etc/letsencrypt/live/[your_domain]`

:::note
โปรดอดทนรอเพราะการเปลี่ยนแปลงระเบียน DNS อาจใช้เวลาสักครู่ในการเผยแพร่ โดยปกติจะใช้เวลาไม่กี่นาที แต่ในบางกรณีอาจนานกว่านั้น
:::

คุณสามารถใช้ใบรับรอง SSL ได้ทุกที่ที่ต้องการโดยระบุเส้นทางภายในเครื่องไปยังใบรับรองเหล่านี้

## ปลั๊กอินเว็บเซิร์ฟเวอร์

Certbot มีปลั๊กอินเว็บเซิร์ฟเวอร์เสริมหลายตัวที่ช่วยให้การจัดการใบรับรองง่ายขึ้น เพราะปลั๊กอินจะปรับแต่งบล็อกเซิร์ฟเวอร์ที่เกี่ยวข้องให้โดยอัตโนมัติ เพื่อใช้ใบรับรองที่สร้างขึ้น ในการใช้ปลั๊กอิน คุณแค่เพิ่มพารามิเตอร์ที่เกี่ยวข้องในคำสั่ง `certbot` ของคุณ

ทั้งสองวิธีนี้ใช้การท้าทาย **HTTP-01** และทำงานในลักษณะเดียวกัน เมื่อใช้ปลั๊กอิน Certbot จะค้นหาบล็อกเซิร์ฟเวอร์ที่มีโดเมนที่ร้องขอในพารามิเตอร์ `server_name` เมื่อเจอแล้ว Certbot จะสร้าง ACME Challenge และเพิ่มบล็อก `location /.well-known/acme-challenge/...` ชั่วคราวในคอนฟิกบล็อกเซิร์ฟเวอร์นั้น

เซิร์ฟเวอร์ของ Let's Encrypt จะพยายามดึงข้อมูลนี้จากเซิร์ฟเวอร์ของคุณ และเมื่อสำเร็จ ใบรับรองจะถูกสร้างขึ้น และคอนฟิกบล็อกเซิร์ฟเวอร์สำหรับเว็บเซิร์ฟเวอร์ที่เลือกจะถูกแก้ไขอัตโนมัติเพื่อใช้ HTTPS (พอร์ต 443) และเพิ่มเส้นทางไปยังใบรับรองที่สร้างใหม่

<Tabs>
<TabItem value="nginx" label="Nginx" default>

### ปลั๊กอิน Nginx

ก่อนใช้ปลั๊กอินนี้ ให้แน่ใจว่าคุณติดตั้งมันแล้ว

```
sudo apt install python3-certbot-nginx
```

เพื่อใช้ปลั๊กอิน Nginx ให้ใช้พารามิเตอร์ `--nginx` ในคำสั่งของคุณดังนี้

```
# สำหรับโดเมนหลัก
certbot --nginx -d [your_root_domain] -d www.[your_root_domain]

# สำหรับซับโดเมน
certbot --nginx -d [your_domain]

# ตั้งค่าแบบโต้ตอบ
certbot --nginx
```

:::tip
ถ้าคุณต้องการปิดการปรับบล็อกเซิร์ฟเวอร์แบบ "คลิกเดียว" อัตโนมัติจาก Certbot คุณสามารถเพิ่มพารามิเตอร์ `certonly` ในคำสั่ง เช่น `certbot certonly`
:::

</TabItem>

<TabItem value="apache" label="Apache">

### ปลั๊กอิน Apache

ก่อนใช้ปลั๊กอินนี้ ให้แน่ใจว่าคุณติดตั้งมันแล้ว

```
sudo apt install python3-certbot-apache
```

เพื่อใช้ปลั๊กอิน Apache ให้ใช้พารามิเตอร์ `--apache` ในคำสั่งของคุณดังนี้

```
# สำหรับโดเมนหลัก
certbot --apache -d [your_root_domain] -d www.[your_root_domain]

# สำหรับซับโดเมน
certbot --apache -d [your_domain]

# ตั้งค่าแบบโต้ตอบ
certbot --apache
```

:::tip
ถ้าคุณต้องการปิดการปรับบล็อกเซิร์ฟเวอร์แบบ "คลิกเดียว" อัตโนมัติจาก Certbot คุณสามารถเพิ่มพารามิเตอร์ `certonly` ในคำสั่ง เช่น `certbot certonly`
:::

</TabItem>

<TabItem value="webroot" label="Webroot">

### ปลั๊กอิน Webroot

ถ้าคุณรันเว็บเซิร์ฟเวอร์ของตัวเองที่ไม่ใช้ซอฟต์แวร์ทั่วไป คุณอาจต้องการใช้วิธี webroot เพื่อใช้เว็บเซิร์ฟเวอร์ของคุณโดยไม่ต้องปิดมัน

เพื่อใช้ปลั๊กอิน Webroot ให้ใช้พารามิเตอร์ `--webroot` ในคำสั่งของคุณ และต้องระบุ `-w [your_webserver_path]` (ย่อมาจาก `--webroot-path`) ซึ่งเป็นเส้นทางไปยังไดเรกทอรีระดับบนสุดของเว็บเซิร์ฟเวอร์ของคุณ

```
# สำหรับโดเมนหลัก
certbot --webroot -w [your_webserver_path] -d [your_root_domain] -d www.[your_root_domain]

# สำหรับซับโดเมน
certbot --webroot -w [your_webserver_path] -d [your_domain]

# ตั้งค่าแบบโต้ตอบ
certbot --webroot -w [your_webserver_path]
```

:::tip
ตำแหน่ง webroot ที่พบบ่อยที่สุดคือ `/var/www/html` คุณยังสามารถใช้วิธีนี้กับเว็บเซิร์ฟเวอร์อย่าง Nginx หรือ Apache ในกรณีที่คุณต้องการใช้เว็บเซิร์ฟเวอร์โดยไม่ต้องให้ปลั๊กอินปรับบล็อกเซิร์ฟเวอร์อัตโนมัติแบบปลั๊กอินเนทีฟ
:::

</TabItem>
</Tabs>

## การต่ออายุอัตโนมัติ

ในกรณีส่วนใหญ่ Certbot จะตั้งค่าการต่ออายุใบรับรองอัตโนมัติให้คุณผ่าน cronjob และ/หรือ systemd timer คุณสามารถตรวจสอบได้โดยรันคำสั่งนี้ซึ่งใช้พารามิเตอร์ `--dry-run` เพื่อทดสอบกระบวนการ

```
certbot renew --dry-run
```

:::tip
อย่างที่บอกไป วิธี **DNS-01** ไม่รองรับการต่ออายุอัตโนมัติผ่าน Certbot เว้นแต่คุณจะตั้งโครงสร้างพื้นฐานของตัวเองเพื่อจัดการเรื่องนี้ ดังนั้นจึงแนะนำให้ใช้วิธี **HTTP-01**
:::

ถ้าทุกอย่างถูกต้อง คำสั่งนี้ควรทำงานสำเร็จ หากคุณต้องการดูหรือแก้ไขการตั้งค่าการต่ออายุอัตโนมัติ คำสั่งจะอยู่ในที่ใดที่หนึ่งใน `/etc/crontab/`, `/etc/cron.*/*` หรือผ่าน `systemctl list-timers`

### ตั้งค่า Cronjob ด้วยตนเอง

ถ้าด้วยเหตุผลใดก็ตามที่การต่ออายุอัตโนมัติไม่ได้ถูกตั้งค่าให้คุณ คุณสามารถเพิ่มเองผ่าน cronjob เปิดเมนู crontab ด้วยคำสั่ง `crontab -e` ถ้านี่เป็นครั้งแรกที่คุณทำ อาจถูกถามให้เลือกโปรแกรมแก้ไข ให้เลือกตัวเลือกแรกซึ่งควรเป็น `/bin/nano`

เมื่อไฟล์เปิดใน nano แล้ว ให้เพิ่มบรรทัดนี้เพื่อรันการต่ออายุทุกวันตอน 6 โมงเช้าตามเวลาท้องถิ่น

```
0 6 * * * certbot renew
```

บันทึกไฟล์และออกจาก nano โดยกด `CTRL + X` ตามด้วย `Y` เพื่อยืนยัน และสุดท้ายกด `ENTER`

## สรุป

คุณได้ตั้งค่า Certbot สำหรับโดเมนของคุณสำเร็จผ่านหลายวิธี รวมถึง standalone, webroot หรือผ่านปลั๊กอินต่าง ๆ ทำให้เว็บไซต์ของคุณมีการส่งข้อมูลที่ปลอดภัยผ่าน HTTPS หากมีคำถามหรือขอความช่วยเหลือเพิ่มเติม อย่าลังเลที่จะติดต่อทีมซัพพอร์ตของเรา ซึ่งพร้อมช่วยเหลือคุณทุกวัน! 🙂

<InlineVoucher />